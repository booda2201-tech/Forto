




<!-- <div class="contt">
  <div class="dashboard-container">
  <div class="stats-grid">
    <div class="mini-card income">
      <span class="label">إجمالي الدخل</span>
      <span class="value">1,539 ج.م</span>
    </div>
    <div class="mini-card active">
      <span class="label">نشط</span>
      <span class="value">3</span>
    </div>
    <div class="mini-card pending">
      <span class="label">انتظار</span>
      <span class="value">10</span>
    </div>
    <div class="mini-card done">
      <span class="label">مكتمل</span>
      <span class="value">25</span>
    </div>
  </div>

  <div class="main-content-grid">
    <div class="forto-card">
      <h3 class="section-title">أداء العمال (اليوم)</h3>
      <div class="table-wrapper">
        <table class="pos-table">
          <thead>
            <tr>
              <th>العامل</th>
              <th class="text-center">السيارات</th>
              <th class="text-left">الحالة</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let staff of staffPerformance">
              <td><strong>{{staff.name}}</strong></td>
              <td class="text-center">{{staff.completedCount}}</td>
              <td class="text-left">
                <span class="status-dot" [ngClass]="staff.isBusy ? 'busy' : 'available'"></span>
                {{staff.isBusy ? 'مشغول' : 'متاح'}}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="forto-card">
      <h3 class="section-title">الخدمات الأكثر طلباً</h3>
      <div class="chart-area">
        <div class="placeholder-text">الرسم البياني مخصص للعرض السريع</div>
      </div>
    </div>
  </div>

  <div class="reports-container" style="max-width: 1200px; margin: auto;">
  <div class="filter-card forto-card mt-4 mb-4 p-3 d-flex align-items-center gap-3">
    <input type="date" class="form-control custom-input" placeholder="من تاريخ">
    <input type="date" class="form-control custom-input" placeholder="إلى تاريخ">
    <button class="btn-submit-order w-50 py-2 fw-bold rounded-3">تحديث التقارير</button>
  </div>

  <div class="row">
    <div class="col-md-6">
      <div class="forto-card p-4 h-100">
        <h5 class="section-title mb-4">توزيع الإيرادات حسب الخدمة</h5>
        <div class="chart-wrapper">
          <canvas id="servicesChart"></canvas>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="forto-card p-4 h-100">
        <h5 class="section-title mb-4">معدل الإنجاز اليومي</h5>
        <canvas id="performanceChart"></canvas>
      </div>
    </div>
  </div>
</div>




</div>
</div> -->





<div class="contt">
  <div class="dashboard-container">

    <!-- Filters -->
    <div class="filter-card forto-card mb-4 p-3 d-flex align-items-center gap-3">
      <input
        type="date"
        class="form-control custom-input"
        [(ngModel)]="fromDate"
        placeholder="من تاريخ"
      />

      <input
        type="date"
        class="form-control custom-input"
        [(ngModel)]="toDate"
        placeholder="إلى تاريخ"
      />

      <button
        class="btn-submit-order w-50 py-2 fw-bold rounded-3"
        (click)="loadSummary()"
        [disabled]="isLoading || !fromDate || !toDate"
      >
        {{ isLoading ? 'جاري التحديث...' : 'تحديث التقارير' }}
      </button>
    </div>

    <!-- Error -->
    <div *ngIf="errorMsg" class="alert alert-danger">
      {{ errorMsg }}
    </div>

    <!-- Stats -->
    <div class="stats-grid">
      <div class="mini-card income">
        <span class="label">إجمالي الدخل</span>
        <span class="value">{{ totalRevenue | number:'1.0-2' }} ج.م</span>
      </div>

      <div class="mini-card done">
        <span class="label">صافي الربح</span>
        <span class="value">{{ netProfit | number:'1.0-2' }} ج.م</span>
      </div>

      <div class="mini-card pending">
        <span class="label">إجمالي التكاليف</span>
        <span class="value">{{ totalCosts | number:'1.0-2' }} ج.م</span>
      </div>

      <div class="mini-card active">
        <span class="label">تكلفة المنتجات</span>
        <span class="value">{{ productsCost | number:'1.0-2' }} ج.م</span>
      </div>
    </div>

    <!-- أداء العمال والخدمات من API -->
    <div class="main-content-grid">
      <div class="forto-card">
        <h3 class="section-title">أداء العمال</h3>
        <p class="text-muted small mb-2" *ngIf="totalDoneItemsEmployees > 0">
          إجمالي الخدمات المنفذة: {{ totalDoneItemsEmployees }}
        </p>
        <div class="table-wrapper">
          <table class="pos-table">
            <thead>
              <tr>
                <th>العامل</th>
                <th class="text-center">العدد</th>
                <th class="text-center">النسبة %</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let emp of dashboardEmployees">
                <td><strong>{{ emp.name }}</strong></td>
                <td class="text-center">{{ emp.count }}</td>
                <td class="text-center">{{ emp.percent | number:'1.1-1' }}%</td>
              </tr>
              <tr *ngIf="dashboardEmployees.length === 0 && !isLoading">
                <td colspan="3" class="text-center text-muted py-3">لا توجد بيانات للفترة المحددة</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="forto-card">
        <h3 class="section-title">الخدمات الأكثر طلباً</h3>
        <p class="text-muted small mb-2" *ngIf="totalDoneItemsServices > 0">
          إجمالي الخدمات المنفذة: {{ totalDoneItemsServices }}
        </p>
        <div class="chart-area py-3">
          <div *ngFor="let service of dashboardServices; let i = index" class="mb-3">
            <div class="d-flex justify-content-between mb-1">
              <small>{{ service.name }}</small>
              <small class="fw-bold">{{ service.count }} ({{ service.percent | number:'1.1-1' }}%)</small>
            </div>
            <div class="progress" style="height: 10px; border-radius: 5px;">
              <div
                class="progress-bar"
                [style.width.%]="service.percent"
                [style.background-color]="getServiceColor(i)"
                role="progressbar"
              ></div>
            </div>
          </div>
          <div *ngIf="dashboardServices.length === 0 && !isLoading" class="text-center text-muted py-3">
            لا توجد بيانات للفترة المحددة
          </div>
        </div>
      </div>
    </div>

    <!-- Optional: show summary breakdown if you want -->
    <div class="reports-container mt-4" *ngIf="summary">
      <div class="row">
        <div class="col-md-6 mb-3">
          <div class="forto-card p-4 h-100 text-center">
            <h5 class="section-title mb-3">تفاصيل التكاليف</h5>
            <div class="text-muted small">
              <div>مواد مستهلكة: {{ summary.materialsConsumeCost | number:'1.0-2' }} ج.م</div>
              <div>مواد تالفة: {{ summary.materialsWasteCost | number:'1.0-2' }} ج.م</div>
              <div>هدايا: {{ summary.giftsCost | number:'1.0-2' }} ج.م</div>
            </div>
          </div>
        </div>

        <div class="col-md-6 mb-3">
          <div class="forto-card p-4 h-100 text-center">
            <h5 class="section-title mb-3">صافي الربح</h5>
            <div style="height: 200px; display:flex; align-items:center; justify-content:center; background:#f9f9f9; border-radius:15px;">
              <span class="fw-bold text-orange" style="font-size: 28px;">
                {{ netProfit | number:'1.0-2' }} ج.م
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

