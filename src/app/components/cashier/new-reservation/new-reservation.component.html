<section class="contt">
  <div class="new-reservation-container">
    <div class="header">
      <h2 class="text-center mb-4 fw-bold text-dark">
        <i class="bi bi-calendar-plus text-orange"></i> حجز جديد
      </h2>
      <p>أدخل بيانات العميل وتفاصيل الخدمة المطلوبة</p>
    </div>

    <form [formGroup]="customerForm" (ngSubmit)="onSubmit()" class="reservation-form">
      <div class="form-section">
        <h3><i class="bi bi-people-fill mx-1"></i> بيانات العميل والسيارة</h3>
        <div class="row">
          <div class="form-group">
            <label><i class="bi bi-person mx-1"></i> اسم العميل </label>
            <input type="text" formControlName="name" placeholder="مثال: عصام الشوالي" />
          </div>
            <div class="form-group">
              <label><i class="bi bi-telephone mx-1"></i> رقم الهاتف </label>
              <input
                type="text"
                formControlName="phone"
                placeholder="+966 5x xxx xxxx"
                class="text-end"
                (keypress)="onlyNumbers($event)"
                inputmode="numeric"
              />
            </div>
        </div>

        <div class="row">
          <div class="form-group">
            <label><i class="bi bi-car-front mx-1"></i> نوع السيارة </label>
            <input type="text" formControlName="carType" placeholder="مثال: تويوتا كامري 2023" />
          </div>
          <div class="form-group">
            <label><i class="bi bi-map mx-1"></i> رقم اللوحة </label>
            <input type="text" formControlName="carNumber" placeholder="ب ص ج 1234" />
          </div>
          <div class="form-group mt-1">
            <label><i class="bi bi-car-front mx-1"></i> فئة السيارة </label>
              <select class="form-select custom-select" formControlName="carCategory">
                <option [ngValue]="null" disabled>اختر فئة السيارة</option>
                <option *ngFor="let cat of carCategories" [ngValue]="cat.id" class="text-dark">
                  {{ cat.nameAr }}
                </option>
              </select>
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3><i class="bi bi-info-circle-fill mx-1"></i> تفاصيل الخدمة</h3>
        <div class="row">
          <div class="form-group col-md-8">
            <label><i class="bi bi-calendar-date mx-1"></i> تاريخ الحجز </label>
            <input type="date" formControlName="appointmentDate" (change)="loadAvailableSlots()" />
          </div>
          <div class="form-group col-md-4">
            <label><i class="bi bi-clock mx-1"></i> الوقت

              <small class="text-muted d-inline-block mb-2 mx-1" *ngIf="isSlotsLoading">
                جاري تحميل المواعيد...
              </small>

            </label>

            <!-- Dropdown -->
            <select class="form-select" [(ngModel)]="selectedSlotHour" [ngModelOptions]="{ standalone: true }"
              [disabled]="availableSlots.length === 0"
>
              <option [ngValue]="null" disabled selected>اختر وقت</option>

              <option *ngFor="let slot of availableSlots" [ngValue]="slot.hour" [disabled]="slot.available === 0">
                {{ slot.hour }} - (متاح: {{ slot.available }})
              </option>
            </select>

            <!-- No slots message -->
            <small class="text-danger d-block mt-2" *ngIf="
                !isSlotsLoading &&
                selectedServices.length > 0 &&
                customerForm.value.appointmentDate &&
                (!availableSlots || availableSlots.length === 0)
              ">
              لا توجد مواعيد متاحة لهذا اليوم.
            </small>
          </div>
        </div>

        <div class="form-group">
          <label class="mb-3"><i class="bi bi-wrench mx-2"></i> اختر الخدمة
          </label>
          <div class="services-container">
            <div class="service-card" *ngFor="let service of services" [class.selected]="isServiceSelected(service)">
              <input type="checkbox" [id]="'service-' + service.id" (change)="toggleService(service, $event)"
                [checked]="isServiceSelected(service)" />
              <label [for]="'service-' + service.id" class="service-content">
                <span class="service-name">{{ service.name }}</span>
                <span class="service-price">{{ service.price }} ج.م</span>
                <div class="check-icon" *ngIf="isServiceSelected(service)">
                  <i class="bi bi-check-circle-fill"></i>
                </div>
              </label>
            </div>
          </div>
        </div>
      </div>

      <div class="form-footer">
        <div class="total-price">
          <span>الإجمالي المتوقع: </span>
          <strong>{{ totalPrice }} ج.م</strong>
        </div>
        <div class="actions">
          <button type="button" class="btn-cancel" (click)="customerForm.reset()">
            إلغاء
          </button>
          <button type="submit" class="btn-save">تأكيد الحجز</button>
        </div>
      </div>
    </form>
  </div>
</section>
